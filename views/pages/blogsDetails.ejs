<%- include('../partials/header') %>

<main class="container py-5">

  <article class="card p-4">
    <% if (blog.blogImage) { %>
      <img 
        src="<%= blog.blogImage %>" 
        class="img-fluid rounded mb-3"
        style="max-height:500px; object-fit:fill; width:100%;"
        alt="Blog Image"
      />
    <% } %>

    <h1 class="mb-3"><%= blog.blogName %></h1>

    <p class="text-muted">
       Posted by <strong><%= blog.author ? blog.author.userName : "Unknown" %></strong> on 
      <%= new Date(blog.createdAt).toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric' }) %> 
      at 
      <%= new Date(blog.createdAt).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true }) %>
    </p>

    <div class="mt-4 mb-5">
      <% blog.blogContent.split('\n').forEach((line) => { %>
        <p><%= line %></p>
      <% }) %>
      </div>
  
      <div class="d-flex">
        <form action="/blogsDetails/<%= blog._id %>/like" method="POST" style="display:inline;">
          <button class="btn px-1 border-0">
            <i class="bi bi-hand-thumbs-up-fill"></i> (<%= blog.likes.length %>)
          </button>
        </form>

        <form action="/blogsDetails/<%= blog._id %>/dislike" method="POST" style="display:inline;">
          <button class="btn px-1 border-0">
            <i class="bi bi-hand-thumbs-down-fill"></i> (<%= blog.dislikes.length %>)
          </button>
        </form>
      </div>

      <div class="mt-5">
        <h4>Comments</h4>

        <% if (author) { %>
          <form action="<%= comment ? '/comments/' + comment._id + '/update' : '/blogDetails/' + blog._id + '/comments' %>" 
                method="POST"
          >
            <textarea name="reviews" class="form-control rounded"><%= comment ? comment.reviews : '' %></textarea>
            <button class="btn btn-primary mt-3 rounded">
              <%= comment ? 'Update' : 'Submit' %>
            </button>
          </form>

        <% } else { %>
          <p>Please <a href="/login">login</a> to comment.</p>
        <% } %>
        
        <div class="mt-4">
          <% comments.forEach(comment => { %>
            <div class="border p-3 mb-2 rounded">
              <p><strong><%= comment.author.userName %></strong>:</p>
              <p><%= comment.reviews %></p>
              <small class="text-muted">
                <%= new Date(comment.createdAt).toLocaleString() %>
              </small>
            
              <% if (author && comment.author._id.toString() === author._id.toString()) { %>
                <a href="/comments/<%= comment._id %>/delete" class="text-danger px-2"><i class="bi bi-trash3-fill"></i></a>
                <a href="/comments/<%= comment._id %>/edit" class="text-primary px-2"><i class="bi bi-pencil-square"></i></a>
              <% } %>
            </div>
          <% }) %>
        </div>
      </div>
  </article>

</main>

<%- include('../partials/footer') %>