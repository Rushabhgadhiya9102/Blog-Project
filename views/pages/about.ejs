<%- include('../partials/header') %>

<main>
  <section class="section">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="profile-content">
            <div class="profile-name d-flex justify-content-between">
              <div class="left-side">
                <h2><%- user.userName %></h2>
                <p><%= user.email %></p>
              </div>
              <div class="right-side">
                <a href="/editProfile" class="btn btn-primary p-2 rounded-sm"
                  ><i class="bi bi-pencil-square"></i> Edit Profile</a
                >
                <a href="/logout" class="btn btn-primary p-2 rounded-sm"
                  ><i class="bi bi-box-arrow-left"></i> Logout</a
                >
              </div>
            </div>
            <div class="aboutMe mt-5">
              <h3>Bio</h3>
              <div> 
                <% if (user.bio) { %>
                  <% user.bio.split('\n').forEach(function(line) { %>
                    <p><%= line %></p>
                  <% }) %>
                <% } else { %>
                  <p>No bio added yet.</p>
                <% } %>
              </div>
            </div>
            <div class="RecentPost mt-5">
              <h3>My Post (<%- blogs.length %>)</h5>

              <div class="mt-3">
                <% if (blogs.length === 0) {%>
                  <div class="vh-100 d-flex justify-content-center align-items-center">
                    <h2>No Blogs Post</h2>
                  </div>
                  <% }else{ %>
                  <div class="row g-3">
                    <% blogs.slice(0,3).forEach(blog => { %>
                    <div class="col-md-4 mb-4">
                      <article
                        class="card rounded shadow article-card article-card-sm h-100"
                      >
                          <div class="card-image">
                            <div class="post-info">
                              <span class="text-uppercase">
                                <%= new Date(blog.createdAt).toLocaleDateString('en-GB', { day:
                                '2-digit', month: 'short', year: 'numeric' }) %>
                              </span>
                              <span class="text-uppercase">
                                <% 
                                const now = new Date(); 
                                const created = new
                                Date(blog.createdAt); 
                                const diffMs = now - created; 
                                const diffMinutes = Math.floor(diffMs / 1000 / 60); 
                                const diffHours = Math.floor(diffMinutes / 60); 
                                const diffDays = Math.floor(diffHours / 24); 
                                let timeAgo = ''; 
                                if(diffMinutes < 1) { 
                                        timeAgo = 'Just now'; 
                                } else if(diffMinutes < 60) { 
                                        timeAgo = diffMinutes + ' minutes ago'; 
                                } else if(diffHours < 24) {
                                        timeAgo = diffHours + ' hours ago'; } 
                                else { 
                                    timeAgo = diffDays + ' days ago';
                                } 

                                %>
                                <%= timeAgo %>
                              </span>
                            </div>
                            <% if(blog.blogImage) { %>
                            <img
                              src="<%= blog.blogImage %>"
                              class="img-fluid w-100 rounded"
                              alt="Blog Image"
                              style="height: 300px; object-fit: cover; object-position: center"
                            />
                            <% } %>
                          </div>
                        <div class="card-body px-0 pb-0">
                          <ul class="post-meta mb-2">
                            <li> <a href="#!"><%= blog.category %></a> </li>
                          </ul>
                          <h2
                            ><a class="post-title " href="/blogsDetails/<%= blog._id %>"
                              ><%= blog.blogName %></a
                            ></h2
                          >
                          <div class="content d-flex justify-content-between">
                            <a class="read-more-btn px-1" href="/blogsDetails/<%= blog._id %>">Read Full Article</a>
                            <div class="d-flex gap-3">
                              <a class="text-danger px-1" href="/myArticles/<%= blog._id %>/delete"><i class="bi bi-trash3-fill"></i></a>
                              <a class="text-danger ml-2 px-1" href="/myArticles/<%= blog._id %>/edit"><i class="bi bi-pencil-square"></i></a>
                            </div>
                          </div>
                        </div>
                      </article>
                    </div>
                    <% }) %>
                  </div>
                  <% } %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<%- include('../partials/footer') %>
